<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>starShopping后台管理页面</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../layui/css/layui.css">
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap.js"></script>
    <script src="../layui/layui.js"></script>
</head>
<body class="layui-layout-body">
<div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabe2" aria-hidden="true">
        <!--  modal-lg和modal-sm控制大小  不使用这两个属性是默认大小  如果觉得默认的三种设置不够，可以自己书写style width-->
        <div class="modal-dialog" style="width: 700px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabe2">
                        聊天窗口
                    </h4>
                </div>
                <div class="modal-body">
                    <div id="mydiv" class="show-chat-content"
                         style="width: 600px;height: 400px;border: 1px solid rosybrown;margin: auto;overflow:auto"></div>
                </div>
                <div class="modal-footer">
                    <div style="width: 600px;margin: 10px auto"><textarea id="client_msg"
                                                                          style="width: 600px;height: 50px"
                                                                          class="control"></textarea>
                        <button id="sendButton" class="layui-btn">发送</button>
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
</div>
<div>
    <div class="modal fade" id="myModa2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">新增商品类型</h4>
                </div>
                <div class="modal-body">
                    <select id="select">
                        <option>女装</option>
                        <option>男装</option>
                        <option>女鞋</option>
                        <option>男鞋</option>
                        <option>母婴洗漱用品</option>
                        <option>个人洗漱用品</option>
                        <option>护肤品</option>
                        <option>彩妆</option>
                        <option>男士护肤品</option>
                        <option>手机</option>
                        <option>电脑</option>
                        <option>生活电器</option>
                        <option>玩具</option>
                        <option>配饰</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="layui-btn" id="insert">新增</button>
                    <button type="button" class="layui-btn" data-dismiss="modal">关闭</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
</div>
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo">后台管理</div>
        <!-- 头部区域（可配合layui已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item"><a href="">商品列表</a></li>
            <!--<li class="layui-nav-item"  id="kefuguanli">-->
            <!--<a href="javascript:;"></a>-->
            <!--<dl class="layui-nav-child">-->
            <!--<dd><a href="../houtaiyuangong/YuanGong.html">客服情况列表</a></dd>-->
            <!--<dd><a href="../houtaiyuangong/KeFuCaoZuoRiZhi.html">客服操作日志</a></dd>-->
            <!--</dl>-->
            <!--</li>-->
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item"><a data-toggle="modal" data-target="#myModal" id="kefu">客户消息<span class="badge"
                                                                                                         id="lianxi"></span></a>
            </li>
            <li class="layui-nav-item">
                <a style="text-decoration:none" onclick="member_show('客服个人信息','kefu-show.html','1','360','400')"
                   href="javascript:;" title="客服个人信息">
                    <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
                    <span id="xingMing"></span>
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="">待添加</a></dd>
                    <dd><a href="">待添加</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item"><a href="../denglu.html">退了</a></li>
        </ul>
    </div>

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree" lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed">
                    <a class="" href="javascript:;">订单管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="../houtaidingdan/DingDanGuanLi.html">订单详列</a></dd>
                        <dd><a href="../houtaidingdan/LieBiaoTongJi.html">订单统计列表</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item layui-nav-itemed">
                    <a class="" href="javascript:;">客户管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="../houtaikehuguanli/yonghuxinxiguanli.html">客户信息列表</a></dd>
                        <dd><a href="../houtaikehuguanli/KeHuCaoZuoRiZhi.html">客户操作日志</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item layui-nav-itemed" id="kefuguanli">
                    <a href="javascript:;">客服管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="/houtaiyuangong/YuanGong.html">客服情况列表</a></dd>
                        <dd><a href="/houtaiyuangong/KeFuCaoZuoRiZhi.html">客服操作日志</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item"><a href="/houtaishangpinguanli/select.html">后台商品管理</a></li>
                <li class="layui-nav-item"><a href="../houtaitongji/xiaoliangtongji.html">销量查询</a></li>
            </ul>
        </div>
    </div>

    <div class="layui-body">
        <div class="demoTable">
            <div class="layui-inline">
                <table>
                    <tr>
                        <td>商品编号</td>
                        <td>商品组编号</td>
                        <td>商品名称</td>
                        <td>商品类型</td>
                        <td>商品规格1</td>
                    </tr>
                    <tr>
                        <td><input class="layui-input" name="id" id="ShangPinBianHao" autocomplete="off"></td>
                        <td><input class="layui-input" name="id" id="ShangPinZuBianHao" autocomplete="off"></td>
                        <td><input class="layui-input" name="id" id="ShangPinMingCheng" autocomplete="off"></td>
                        <td><input class="layui-input" name="id" id="ShangPinLeiXin" autocomplete="off"></td>
                        <td><input class="layui-input" name="id" id="ShangPinGuiGe1" autocomplete="off"></td>
                    </tr>
                    <tr>
                        <td>商品规格2</td>
                        <td>品牌</td>
                        <td>商品价格</td>
                        <td>商品成本</td>
                        <td>月销量</td>
                    </tr>
                    <tr>
                        <td><input class="layui-input" name="id" id="ShangPinGuiGe2" autocomplete="off"></td>
                        <td><input class="layui-input" name="id" id="PinPai" autocomplete="off"></td>
                        <td><input class="layui-input" name="id" id="ShangPinJiaGe" autocomplete="off"></td>
                        <td><input class="layui-input" name="id" id="ShangPinChengBen" autocomplete="off"></td>
                        <td><input class="layui-input" name="id" id="YueXiaoLiang" autocomplete="off"></td>
                    </tr>
                    <tr>
                        <td>总销量</td>
                        <td>商品状态</td>
                        <td>操作时间</td>
                    </tr>
                    <tr>
                        <td><input class="layui-input" name="id" id="ZongXiaoLiang" autocomplete="off"></td>
                        <td>
                            <select class="layui-select" name="id" id="ShangPinZhuangTai">
                                <option value="">全部</option>
                                <option value="1">已上架</option>
                                <option value="2">下架中</option>
                            </select></td>
                        <td><input type="text" class="layui-input" name="id" id="CaoZuoShiJian" autocomplete="off"></td>
                        <td>
                            <button class="layui-btn layui-btn-fluid" data-type="reload">搜索</button>
                        </td>
                        <td>
                            <button class="layui-btn layui-btn-fluid" id="clear">重置</button>
                        </td>
                    </tr>
                </table>
            </div>

        </div>
        <table id="mytable" lay-filter="test">
        </table>
        <div class="layui-btn-group demoTable">
            <button class="layui-btn" data-toggle="modal" data-target="#myModa2">新增</button>
            <button class="layui-btn" data-type="getCheckData">删除</button>
        </div>
    </div>

    <div class="layui-footer">
        <!-- 底部固定区域 -->
        © layui.com - 底部固定区域
    </div>
</div>
</body>
<script>

    $(function () {
        function chushi() {
            $.ajax({
                url: "/Shangpinxinxi/xinZeng",
                type: "POST",            // 请求的方式，不区分大小写
                cache: false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
                datatype: "json",        // 返回类型，text文本、html页面、json数据
                data: {
                    runCode: '0'
                },
                success: function (response) {
                    if (response.returncode === -100) {
                        $(location).attr("href", "/denglu.html");
                    } else {
                        $("#xingMing").text(response.username)
                        if (response.username != '大老板') {
                            $("#kefuguanli").css("display", "none");
                        }
                    }
                },
                error: function (response) {
                    alert(response)
                }
            });
        }

        chushi();

        /*用户-查看*/
        function member_show(title, url, id, w, h) {
            if (title == null || title == '') {
                title = false;
            }
            ;
            if (url == null || url == '') {
                url = "404.html";
            }
            ;
            if (w == null || w == '') {
                w = 800;
            }
            ;
            if (h == null || h == '') {
                h = ($(window).height() - 50);
            }
            ;
            layer.open({
                type: 2,
                area: [w + 'px', h + 'px'],
                fix: false, //不固定
                maxmin: true,
                shade: 0.4,
                title: title,
                content: url
            });
        }
    });
    $("#insert").click(function () {
        location.href = "/houtaishangpinguanli/insert.html?ShangPinLeiXin=" + $("#select").val();
    });
    $("#clear").click(function () {
        $("input[type='text']").each(function () {
            this.text = "";
        });
    });
    layui.use('laydate', function () {
        var laydate = layui.laydate;
        laydate.render({
            elem: "#CaoZuoShiJian",
            type: "datetime"
        })
    });
    layui.use('table', function () {
        var table = layui.table;
        //第一个实例
        table.render({
            elem: '#mytable'
            , url: '/Shangpinxinxi/chaxun' //数据接口
            , parseData: function (res) { //res 即为原始返回的数据
                return {
                    "code": res.code, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.count, //解析数据长度
                    "data": JSON.parse(res.data) //解析数据列表
                };
            }
            , page: true //开启分页
            , cols: [[ //表头
                {field: 'id', type: "checkbox", fixed: 'left'}
                , {field: 'count', type: "numbers", title: "序号"}
                , {field: 'shangPinBianHao', width: 170, title: '商品编号'}
                , {field: 'shangPinZuBianHao', width: 130, title: '商品组编号', sort: true}
                , {field: 'shangPinMingCheng', title: '商品名称'}
                , {field: 'shangPinLeiXin', title: '商品类型'}
                , {field: 'shangPinGuiGe1', title: '商品规格1'}
                , {field: 'shangPinGuiGe2', title: '商品规格2'}
                , {field: 'pinPai', title: '品牌'}
                , {field: 'shangPinJiaGe', title: '商品价格', sort: true}
                , {field: 'shangPinChengBen', title: '商品成本', sort: true}
                , {field: 'yueXiaoLiang', title: '月销量', sort: true}
                , {field: 'zongXiaoLiang', title: '总销量', sort: true}
                , {field: 'shangPinZhuangTai', width: 100, title: '商品状态', sort: true}
                , {field: 'caoZuoShiJian', title: '操作时间', sort: true}
                , {field: 'caoZuo', width: 95, title: '操作', fixed: 'right', toolbar: '#bar'}
            ]]
            , limit: 10
            , id: 'idTest'
        });
        table.on('tool(test)', function (obj) {
            var data = obj.data;
            alert(data.shangPinZuBianHao)
            location.href = "/houtaishangpinguanli/update.html?ShangPinBianHao=" + data.shangPinBianHao;
        });
        var $ = layui.$, active = {
            reload: function () {
                //执行重载
                table.reload('idTest', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    , where: {
                        ShangPinBianHao: $('#ShangPinBianHao').val()
                        , ShangPinZuBianHao: $('#ShangPinZuBianHao').val()
                        , ShangPinMingCheng: $('#ShangPinMingCheng').val()
                        , ShangPinLeiXin: $('#ShangPinLeiXin').val()
                        , ShangPinGuiGe1: $('#ShangPinGuiGe1').val()
                        , ShangPinGuiGe2: $('#ShangPinGuiGe2').val()
                        , PinPai: $('#PinPai').val()
                        , ShangPinJiaGe: $('#ShangPinJiaGe').val()
                        , ShangPinChengBen: $('#ShangPinChengBen').val()
                        , YueXiaoLiang: $('#YueXiaoLiang').val()
                        , ZongXiaoLiang: $('#ZongXiaoLiang').val()
                        , ShangPinZhuangTai: $('#ShangPinZhuangTai').val()
                        , CaoZuoShiJian: $('#CaoZuoShiJian').val()
                    }
                });
            },
            getCheckData: function () { //获取选中数据
                var checkStatus = table.checkStatus('idTest')
                    , data = checkStatus.data;
                // layer.alert(JSON.stringify(data));
                var list = [];
                for (var i = 0; i < data.length; i++) {
                    list[i] = data[i].id;
                }
                $.ajax({
                    url: "/Shangpinxinxi/delete",
                    type: "post",
                    cache: false,
                    datatype: "application/json",
                    data: {
                        "ids": "" + list
                    },
                    success: function (response) {
                        if (response.returncode === -100) {
                            $(location).attr("href", "/denglu.html");
                        }
                        var type = "成功删除";
                        if (response.returnCode == 1) {
                            type = "删除失败，有已上架商品存在";
                        } else if (response.returnCode == 2) {
                            type = "请勾选商品信息";
                        }
                        alert(type);
                        chushi();
                    },
                    error: function (response) {
                        alert("错误信息" + response)
                    }
                })
            }
        };
        $('.demoTable .layui-btn').on('click', function () {
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
    // $(function () {
    //     $("#sendButton").click(function () {
    //         var msg = $("#client_msg").val();
    //         $("#mydiv").append("<div style='margin-top: 20px;margin-right: 10px;text-align: right'><span style='font-size: 15px;color: red;'>你说:" + msg + "</span><p/>");
    //         $.ajax({
    //             url: "/clientServlet",    // 请求路径
    //             type: "post",            // 请求的方式，不区分大小写
    //             cache: false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
    //             datatype: "text",        // 返回类型，text文本、html页面、json数据
    //             data: {
    //                 YongHuMing: 'zhangsan',
    //                 msgKey: msg,
    //                 action: 2,
    //                 yongHuMing: 'kefu'
    //             },
    //             success: function (response) {
    //                 //alert("数据: " + response);
    //             },
    //             error: function (response) {
    //                 alert("出错" + response);
    //             }
    //         });
    //         $("#client_msg").val("");
    //         var showContent = $(".show-chat-content");
    //         showContent[0].scrollTop = showContent[0].scrollHeight;
    //     });
    // });
    // var count = 0;
    //
    // function getMsg() {
    //     $.ajax({
    //         url: "/serverServlet",    // 请求路径
    //         type: "post",            // 请求的方式，不区分大小写
    //         cache: false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
    //         datatype: "json",        // 返回类型，text文本、html页面、json数据
    //         data: {
    //             action: 1
    //         },
    //         success: function (response) {
    //             //alert("数据: " + response);
    //             if (response != null && response != "") {   // 如果后台服务没有数据，则不会添加
    //                 $("#mydiv").append("<div style='margin-top: 20px'><span style='font-size: 15px;color: royalblue;'>" + response.yongHuMing + ":" + response.msgKey + "</span></div>");
    //                 count++;
    //             }
    //         },
    //         error: function (response) {
    //             console.log("出错" + JSON.stringify(response));
    //         }
    //     });
    //     $("#kefu").click(function () {
    //         count = 0;
    //     });
    //     $("#lianxi").text(0 + count);
    // }
    //
    // setInterval("getMsg()", 50);    // 轮询
</script>
<script type="text/html" id="bar">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
</script>
</html>