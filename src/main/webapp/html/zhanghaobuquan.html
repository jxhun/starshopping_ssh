<!DOCTYPE html>
<html lang="zh-cmn-Hans" xmlns:https="http://www.w3.org/1999/xhtml">
<head>
    <title>StartShopping-账号补全</title>
    <meta charset="UTF-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <link href="//member-ssl.vipstatic.com/css/public/passport/1/common-hash-153439cd.css" type="text/css" rel="stylesheet">
    <link href="//member-ssl.vipstatic.com/css/public/passport/1/login-hash-9f38e6b2.css" type="text/css" rel="stylesheet">
    <style>
        /*#ff006e*/
        #StartShopping-login{color: #ff006e;width:315px;height:73px;
            font-size: 40px;position: absolute;top: 40px;}
        #yonghuming{width: 248px;}
    </style>
</head>
<body class="regSingle  J-container">
<div class="c-header"
     passport_mars_sead_hover>
    <div class="c-header-inner">
        <div class="c-logo">
            <a class=""
               id="StartShopping-login"
               href="#">StartShopping</a>
        </div>

        <div class="c-service"></div>
    </div>
</div>
<div class="c-body  J-ads"
     data-adsid="ADSJ867S"
     data-bg="true" style="background-image: url('https://img.vipstatic.com/upload/flow/2018/06/15/157/15290438491111.jpg');">
    <div class="c-content  f-clearfix">
        <div class="c-register  f-right">
            <div class="c-register-header">

                <h3 class="c-register-title">账号补全</h3>
            </div>
            <div class="c-register-body">
                <input type="hidden" name="vipc" value="" />
                <div id="reg-form-wrapper">
                    <div class="ui-tips-big ui-tips1 c-register-top-tips hidden">
                        <i class="vipFont if-sigh">&#xe603;</i>
                        <a href="javascript:;" role="button" class="close">&times;</a>
                        <p class="info"><i class="vipFont if-sigh">&#xe603;</i><span class="info-msg"></span></p>
                    </div>

                    <form id="reg_mobile_form" action="/register" method="post" autocomplete="off" class="register-form">
                        <div class="control-group  has-form-item-icon  clearfix">
                            <div class="ui-form-item-group">
                                <input readonly type="text"
                                       class="ui-input ipt-phone" id="J_mobile_name"
                                       name="loginName"
                                       placeholder="请输入手机号码"
                                       passport_mars_sead_hover passport_mars_sead_input='mobileRegMobile'/>
                                <span class="u-input-warning vipFont if-wrong">&#xe621;</span>
                                <span class="u-input-success vipFont if-success">&#xe61e;</span>
                                <span class="c-icon  c-icon-mobile  c-icon-form"></span>
                            </div>
                            <div class="u-input-tip"><span class="text" id="shoujihaomaspan"></span></div>
                        </div>

                        <div class="control-group" id="J_verify_code_mobile"></div>

                        <div class="control-group  has-form-item-icon  clearfix">
                            <div class="ui-form-item-group adjust-tip-icon">
                                <input type="text"
                                       id="yonghuming" class="ui-input ipt-verify-code"
                                       name="pvcode"
                                       maxlength="16"
                                       placeholder="用户名为1-16的数字，字母和汉字组合,且不能以数字开头"
                                       passport_mars_sead_hover passport_mars_sead_input='mobileRegMobileCode'/><!--
             -->
                                <span class="u-input-warning vipFont if-wrong">&#xe621;</span>
                                <span class="u-input-success vipFont if-success">&#xe61e;</span>
                                <span class="c-icon  c-icon-captcha  c-icon-form"></span>
                            </div>
                            <div class="u-input-tip"><span id="yonghumingspan" class="text"></span></div>
                        </div>

                        <div class="control-group  has-form-item-icon  clearfix">
                            <div class="ui-form-item-group">
                                <input readonly type="password"
                                       class="ui-input" id="J_mobile_pwd"
                                       name="password"
                                       maxlength="20"
                                       placeholder="密码由6-20位字母，数字和符号组合"
                                       passport_mars_sead_hover
                                       passport_mars_sead_input='mobileRegPw'/>
                                <span class="u-input-warning vipFont if-wrong">&#xe621;</span>
                                <span class="u-input-success vipFont if-success">&#xe61e;</span>
                                <span class="c-icon  c-icon-password  c-icon-form"></span>
                            </div>
                            <div class="u-input-tip">
                                <span id="mimaspan" class="text password-tip"></span>
                            </div>
                        </div>

                        <div class="control-group  has-form-item-icon  clearfix">
                            <div class="ui-form-item-group">
                                <input type="text"
                                       class="ui-input confirm-pwd" id="youxiangtext"
                                       name="confirmPassword"
                                       placeholder="请输入您的邮箱地址"
                                       passport_mars_sead_hover
                                       passport_mars_sead_input='mobileRegCPw'/>
                                <span class="u-input-warning vipFont if-wrong">&#xe621;</span>
                                <span class="u-input-success vipFont if-success">&#xe61e;</span>
                                <span class="c-icon  c-icon-captcha  c-icon-form"></span>
                            </div>
                            <div class="u-input-tip"><span id="youxiangspan" class="text"></span></div>
                        </div>

                        <div class="control-group mb30 clearfix">
                            <a  role="button" id="J_mobile_reg_button" class="ui-btn-large ui-btn-primary ui-btn-loading reg-form-btn form-submit" passport_mars_sead_hover>
                                <span class="ui-btn-loading-before">确认提交</span>
                                <span class="ui-btn-loading-after"><i class="ii-loading-gray-16x16"></i><span class="ui-btn-txt">处理中...</span></span>
                            </a>
                        </div>
                    </form>
                </div>
                <script type="text/javascript">
                    var isThirdLogin = false;
                </script>
            </div>
        </div>
    </div>
</div>

<div class="c-footer">
    <p class="c-copyright">Copyright 2008-2018 StartShopping.com，All Rights Reserved ICP证：川 B2-20080329</p>
</div>

<noscript><img src="//mar.vip.com/n" height="1" width="1" border="0" alt="" /></noscript>
</body>
<script src="../js/jquery-3.3.1.min.js"></script>
<script>
    $(function () {
        var youxiangtext = $("#youxiangtext");//邮箱输入框
        var youxiangspan = $("#youxiangspan");//邮箱输入框下方span
        var yonghumingtext = $("#yonghuming");//用户名输入框
        var yonghumingspan = $("#yonghumingspan");//用户名输入框下方span
        //获得session中的手机号码和密码添加到最有的输入框中 start---------------------------
       function shoujihaomahemima() {
           var json = {option:"4",shoujihaoma:"zhanwei"};
           $.ajax({
               url:"/ZhuCeServlet",   // 请求路径
               type:"post",            // 请求的方式，不区分大小写
               async:true,             // 是否异步，true是默认值，false为同步请求
               cache:false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
               contentType:"application/json;charset=utf-8",
               datatype:"json",        // 返回类型，text文本、html页面、json数据
               data:JSON.stringify(json),
               success:function(response){//回调函数
                 $("#J_mobile_name").val(""+response.shoujihaoma+"");
                 $("#J_mobile_pwd").val(""+response.mima+"");
               },
               error:function(response){//回调函数
               }
           });
       }
       shoujihaomahemima();
        //获得session中的手机号码和密码添加到最有的输入框中 end-----------------------------
        //邮箱输入框 start------------------------------------------------------------------
        function checkMailIsExist() {
            var youxiang = youxiangtext.val();
            var json = {option:"5",youxiang:""+youxiang+"",shoujihaoma:""+$("#J_mobile_name").val()+""};
            var count = null;//false为不存在
            $.ajax({
                url:"/ZhuCeServlet",   // 请求路径
                type:"post",            // 请求的方式，不区分大小写
                async:false,             // 是否异步，true是默认值，false为同步请求
                cache:false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
                contentType:"application/json;charset=utf-8",
                datatype:"json",        // 返回类型，text文本、html页面、json数据
                data:JSON.stringify(json),
                success:function(response){//回调函数
                    count = response.panduancount;
                },
                error:function(response){//回调函数
                }
            });
            return count;
        }//利用ajax异步判断邮箱号是否已被注册
        youxiangtext.blur(function () {
            //判断邮箱是否合法的正则表达式
            //test（） true为合法，false为不合法
            var patrn=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
            var action = false;
            var message ="";
            if(youxiangtext.val() == ""){
                message = "邮箱不能为空！";
            }else if(!patrn.test(youxiangtext.val())){
                message = "请输入有效的邮箱号！";
            }else if(checkMailIsExist() == 1){
                message = "改邮箱号已被绑定！";
            }else {
                action = true;
                message = "可用的邮箱号";
            }

            if(!action){
                youxiangspan.html("<font color='#f64a4a'>"+message+"</font>");
                youxiangtext.css({"border-color":"#f64a4a"});
            }else {
                youxiangspan.html("<font>"+message+"</font>");
                youxiangtext.css({"border-color":"#ccc"});
            }


        });//邮箱输入框失去焦点时
        //邮箱输入框 end--------------------------------------------------------------------
        //用户名输入框 start----------------------------------------------------------------
        function checkMingIsExist() {
            var yonghumingval = yonghumingtext.val();
            var json = {option:"6",yonghuming:""+yonghumingval+"",shoujihaoma:""+$("#J_mobile_name").val()+""};
            var count = null;
            $.ajax({
                url:"/ZhuCeServlet",   // 请求路径
                type:"post",            // 请求的方式，不区分大小写
                async:false,             // 是否异步，true是默认值，false为同步请求
                cache:false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
                contentType:"application/json;charset=utf-8",
                datatype:"json",        // 返回类型，text文本、html页面、json数据
                data:JSON.stringify(json),
                success:function(response){//回调函数
                    count = response.panduancount;
                },
                error:function(response){//回调函数
                }
            });
            return count;
        }//利用ajax异步判断邮箱号是否已被注册
        yonghumingtext.focus(function () {
            yonghumingspan.html("<font>用户名为1-16的数字，字母和汉字组合,且不能以数字开头</font>");
        });//用户名输入框获得焦点时
        yonghumingtext.blur(function () {
            // 用户名可以由字母、数字、下划线和中文组成，以中文或字母开头，长度为1-16位
            //test（） true为合法，false为不合法
            var uPattern =/^([a-zA-Z]|[\u4E00-\u9FA5]){1}([a-zA-Z0-9]|[\u4E00-\u9FA5]|[_]){1,16}$/;
            var yonghumingvalue = yonghumingtext.val();
            var action = false;
            var message = "";
            if(yonghumingvalue == ""){
                 message = "用户名不能为空！";
            }else if(!uPattern.test(yonghumingvalue)){
                 message = "用户名不符合规则！";
            }else if(checkMingIsExist() == 1){
                message = "用户名已经被占用！";
            }else {
                action = true;
                message = "可用的用户名";
            }

            if(!action){//用户名不可用时
                yonghumingspan.html("<font color='#f64a4a'>"+message+"</font>");
                yonghumingtext.css({"border-color":"#f64a4a"});
            }else{//用户名可用时
                yonghumingspan.html("<font>"+message+"</font>");
                yonghumingtext.css({"border-color":"#ccc"});
            }

        });//用户名输入框失去焦点时
        //用户名输入框 end------------------------------------------------------------------
        // 提交按钮 start-------------------------------------------------------------------
        var tijiao = $("#J_mobile_reg_button");//注册按钮(a标签)
        tijiao.click(function () {
            if(youxiangspan.text() == "可用的邮箱号" &&
                yonghumingspan.text() == "可用的用户名"){//注册提交
                var json = {option:"7",
                    shoujihaoma:""+$("#J_mobile_name").val()+"",
                    mima:""+$("#J_mobile_pwd").val()+"",
                    youxiang:""+$("#youxiangtext").val()+"",
                    yonghuming:""+$("#yonghuming").val()+""};
                var action = false;//false为不存在
                $.ajax({
                    url:"/ZhuCeServlet",   // 请求路径
                    type:"post",            // 请求的方式，不区分大小写
                    async:true,             // 是否异步，true是默认值，false为同步请求
                    cache:false,            // 关闭缓存，目的是为了避免部分浏览器缓存加载出错(IE)
                    contentType:"application/json;charset=utf-8",
                    datatype:"json",        // 返回类型，text文本、html页面、json数据
                    data:JSON.stringify(json),
                    success:function(response){//回调函数
                        location.href = response.url;
                    },
                    error:function(response){//回调函数
                    }
                });
            }else if(youxiangspan.text() != "可用的邮箱号" ){
                youxiangtext.css({"border-color":"#f64a4a"});
                youxiangspan.html("<font color='#f64a4a'>请输入可用的邮箱号</font>");
            }else if(yonghumingspan.text() != "可用的用户名"){
                yonghuming.css({"border-color":"#f64a4a"});
                yonghumingspan.html("<font color='#f64a4a'>请输入可用的用户名</font>");
            }
        });//提交按钮点击事件
        // 提交按钮 end---------------------------------------------------------------------

    });
</script>
</html>
